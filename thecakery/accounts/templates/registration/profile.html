{% extends "base/base.html" %}

{% block title %}Profile{% endblock %}

{% block style %}
<style>
    .modal {
        display: none; 
        position: fixed; 
        z-index: 1; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgb(0,0,0); 
        background-color: rgba(0,0,0,0.4); 
        padding-top: 60px;
    }
    
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }
    
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    
    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    
    button {
        padding: 10px;
        margin: 5px;
        cursor: pointer;
    }
</style>    
{% endblock %}

{% block content %}
<h2>Your Profile</h2>

<p><strong>First Name:</strong> {{ user.first_name }}</p>
<p><strong>Last Name:</strong> {{ user.last_name }}</p>
<p><strong>Username:</strong> {{ user.username }}</p>
<p><strong>Email:</strong> {{ user.email }}</p>

<h1>Track Orders</h1>
<a href="{% url 'order_history' %}"><h3>History</h3></a>

{% if orders %}
    <ul>
    {% for order in orders %}
        <li>
            <a href="{% url 'order_detail' order.id %}"><h3>Order #{{ order.id }}</h3></a>
            <p><strong>Total Price:</strong> ${{ order.total_price }}</p>
            <p><strong>Payment Status:</strong> {{ order.payment_status }}</p>
            <p><strong>Payment Method:</strong> {{ order.get_payment_method_display }}</p>
            <p><strong>Shipping Status:</strong> {{ order.get_shipping_status_display }}</p>
            <p><strong>Destination:</strong> {{ order.destination }}</p>
            <p><strong>Created At:</strong> {{ order.created_at }}</p>
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>You have no orders to track.</p>
{% endif %}

<button><a class="text-white" href="{% url 'password_change' %}">Change Password</a></button>
<button id="logoutBtn" class="text-white">Logout</button>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal" style="display: none;">
    <div class="modal-content">
        <form id="logout-form" method="POST" action="{% url 'logout' %}" style="display: inline;">
            {% csrf_token %}
            <h2>Are you sure you want to logout?</h2>
            <button type="button" id="cancelLogout" class="text-white">Cancel</button>
            <button type="submit" class="text-white">
                Yes, Logout
            </button>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Get modal and buttons
    var logoutModal = document.getElementById("logoutModal");
    var logoutBtn = document.getElementById("logoutBtn");
    var cancelLogout = document.getElementById("cancelLogout");
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the logout button, open the modal 
    logoutBtn.onclick = function() {
        logoutModal.style.display = "block";
    }

    // When the user clicks on cancel, close the modal
    cancelLogout.onclick = function() {
        logoutModal.style.display = "none";
    }

    // When the user clicks on the close button (x), close the modal
    span.onclick = function() {
        logoutModal.style.display = "none";
    }

    // // When the user clicks outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == logoutModal) {
            logoutModal.style.display = "none";
        }
    }

    document.getElementById('cancelLogout').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the default form submission behavior
        document.getElementById('logoutModal').style.display = 'none'; // Close the modal
    });
</script>
{% endblock %}
