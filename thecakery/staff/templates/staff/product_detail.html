{% extends "staff/base.html" %}
{% load static %}

{% block title %}
<title>Product Detail</title>
{% endblock %}

{% block content %}
<div class="container-xxl position-relative bg-white d-flex p-0">
    {% include 'staff/components/spinning.html' %}
    {% include 'staff/components/logout-modal.html' %}
    {% include 'staff/components/sidebar.html' %}

    <div class="content">
        {% include 'staff/components/navbar.html' %}

        <div class="container-fluid pt-4 px-4">
            <div class="bg-light text-center rounded p-4">
                <h6 class="mb-4">Product Detail</h6>
                
                {% if object %}
                    <div class="card mb-4">
                        <div class="card-header">
                            <h2 class="card-title">{{ object.name }}</h2>
                        </div>
                        <div class="card-body">
                            {% if object.description %}
                                <p class="card-text">{{ object.description }}</p>
                            {% endif %}
                            
                            {% if object.price %}
                                <p class="card-text"><strong>Price:</strong> ${{ object.price }}</p>
                            {% endif %}
                            
                            {% if object.stock %}
                                <p class="card-text"><strong>Stock:</strong> {{ object.stock }}</p>
                            {% endif %}

                            {% if object.images.all %}
                                <div class="mb-3">
                                    <strong>Images:</strong>
                                    <div class="text-center">
                                        <div class="row justify-content-center">
                                            {% for image in object.images.all %}
                                                <div class="col-md-3 mb-2">
                                                    <img src="{{ image.image.url }}" alt="{{ image.alt_text }}" class="img-fluid rounded shadow-sm mx-auto">
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            
                            {% if product_type == 'cake' %}
                                <!-- Cake-specific fields -->
                                {% if object.cake_type %}
                                    <p class="card-text"><strong>Cake Type:</strong> {{ object.cake_type }}</p>
                                {% endif %}
                                
                                {% if object.category %}
                                    <p class="card-text"><strong>Category:</strong> {{ object.category }}</p>
                                {% endif %}
                                
                                {% if object.flavours.all %}
                                    <div class="mb-3">
                                        <strong>Flavours:</strong>
                                        <ul class="list-group">
                                            {% for flavour in object.flavours.all %}
                                                <li class="list-group-item">{{ flavour.name }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endif %}
                                
                                {% if object.sizes.all %}
                                    <div class="mb-3">
                                        <h4>Available Sizes</h4>
                                        <ul class="list-group">
                                            {% for size in object.sizes.all %}
                                                <li class="list-group-item">{{ size.size }} - ${{ size.additional_price }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endif %}
                            {% elif product_type == 'accessory' %}
                                <!-- PartyAccessory-specific fields -->
                                <!-- Add any additional fields for PartyAccessory if necessary -->
                            {% endif %}
                            
                        </div>
                        <div class="card-footer text-end">
                            <a href="javascript:history.back()" class="btn btn-primary">Back</a>
                            {% if product_type == 'cake' %}
                                <a href="{% url 'manage_images' product_type=product_type pk=object.pk %}" class="btn btn-info">Manage Images</a>
                                <a href="{% url 'manage_flavours' pk=object.pk %}" class="btn btn-info">Manage Flavours</a>
                                <a href="{% url 'manage_sizes' pk=object.pk %}" class="btn btn-info">Manage Sizes</a>
                                <a href="{% url 'modify_product' 'cake' object.pk %}" class="btn btn-warning">Modify Product</a>
                            {% elif product_type == 'accessory' %}
                                <a href="{% url 'manage_images' product_type=product_type pk=object.pk %}" class="btn btn-info">Manage Images</a>
                                <a href="{% url 'modify_product' 'accessory' object.pk %}" class="btn btn-warning">Modify Product</a>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <p>Product not found.</p>
                {% endif %}
                
            </div>
        </div>

        {% include 'staff/components/footer.html' %}
    </div>
</div>
{% endblock %}
